<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุดุฌุฑุฉ ุนุงุฆูุฉ ูู โ ูููุน ุชูุงุนูู</title>
  <meta name="description" content="ูููุน ุชูุงุนูู ุฌููู ููุฑุชุจ ูุนุฑุถ ุดุฌุฑุฉ ุนุงุฆูุฉ ูู ูุน ุจุญุซ ุฐููุ ูุถุน ููููุ ูุฃุฏูุงุช ุชููู.">
  <style>
    :root{
      --bg: #0b1016;
      --panel: #0f1620;
      --muted: #a0b3c5;
      --text: #eef3f8;
      --accent: #4cc9f0;
      --accent-2: #a6e3a1;
      --border: #1d2936;
      --chip: #152231;
      --mark: #ffde8a;
      --shadow: 0 6px 24px rgba(0,0,0,.25);
    }
    [data-theme="light"]{
      --bg:#f6f7fb; --panel:#ffffff; --text:#0f172a; --muted:#42536a; --accent:#2563eb;
      --accent-2:#059669; --border:#e5e7eb; --chip:#f1f5f9; --shadow:0 8px 24px rgba(2,6,23,.08);
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.7 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Naskh Arabic","Amiri",Tahoma,Arial,sans-serif;}
    .shell{display:grid;grid-template-columns: 290px 1fr; gap:16px; max-width:1200px; margin:0 auto; padding:18px;}
    header.app{
      position:sticky; top:0; z-index:40;
      background:linear-gradient(180deg, rgba(0,0,0,.22), transparent);
      backdrop-filter: blur(6px);
      padding:12px 18px; border-bottom:1px solid var(--border);
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:36px;height:36px;border-radius:10px;
      background: radial-gradient(120px 50px at 70% 20%, var(--accent), transparent),
                  radial-gradient(120px 60px at 0% 120%, var(--accent-2), transparent),
                  radial-gradient(80px 30px at 100% 100%, #f59e0b, transparent);
      box-shadow: var(--shadow); border:1px solid var(--border);
    }
    .brand h1{font-size:18px;margin:0}
    .bar{display:flex;justify-content:space-between;align-items:center;gap:12px;max-width:1200px;margin:0 auto}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--border); background:var(--panel); color:var(--text);
      padding:8px 12px;border-radius:12px;cursor:pointer; box-shadow:var(--shadow);
    }
    .btn:hover{border-color:var(--accent);}
    .btn.secondary{background:var(--chip)}
    .btn.ghost{background:transparent;border-color:var(--border)}
    .sidebar{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow);height:max-content;position:sticky;top:70px}
    .sidebar h2{margin:6px 0 12px 0;font-size:16px;color:var(--muted)}
    .group{display:grid;gap:8px;margin-bottom:14px}
    .input{display:flex;gap:8px}
    .input input[type="search"]{flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--chip);color:var(--text)}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--border);background:var(--chip);color:var(--text);padding:6px 10px;border-radius:999px;cursor:pointer}
    .chip.active{outline:2px solid var(--accent)}
    .content{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .hint{color:var(--muted);font-size:14px;margin-bottom:10px}
    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .stat{background:var(--chip);border:1px solid var(--border);border-radius:12px;padding:8px 10px;color:var(--muted);font-size:14px}
    .tree{list-style:none;margin:0;padding:0}
    .tree, .tree ul{margin:0;padding:0}
    .tree li{list-style:none;position:relative;margin:6px 0;padding:8px 12px;border:1px solid var(--border);background:var(--chip);border-radius:12px}
    .label{display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none}
    .name{font-weight:600}
    .caret{width:0;height:0;border-top:6px solid transparent;border-bottom:6px solid transparent;border-right:8px solid var(--muted);transition:transform .2s ease}
    .node.expanded>.label .caret{transform:rotate(-90deg)}
    .children{margin:8px 18px 0 0;display:none}
    .node.expanded>.children{display:block}
    .breadcrumbs{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0}
    .crumb{background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:14px}
    mark{background:var(--mark);padding:0 2px;border-radius:3px}
    footer.app{max-width:1200px;margin:16px auto 28px auto;color:var(--muted);padding:0 18px;font-size:13px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:var(--chip);border:1px solid var(--border);border-radius:6px;padding:2px 6px}
    @media (max-width: 980px){
      .shell{grid-template-columns: 1fr; padding:12px}
      .sidebar{position:relative;top:auto}
    }
  
@media (max-width: 980px){
  .mobile-hide { display: none !important; }
}


.info-box {
  display: none;
  margin-top: 20px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow: var(--shadow);
  padding: 20px;
  line-height: 1.8;
  font-size: 16px;
  animation: fadeIn 0.4s ease-in-out;
}
.info-box h3 {
  margin-top: 0;
  color: var(--accent);
}
.info-box p {
  margin: 8px 0;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

</style>
</head>
<body data-theme="dark">
  <header class="app">
    <div class="bar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>ุดุฌุฑุฉ ุนุงุฆูุฉ ูู โ ูููุน ุชูุงุนูู</h1>
      </div>
      <div class="actions">
        <button id="themeBtn" class="btn secondary" title="ุชุจุฏูู ุงููุถุน">ุงููุถุน ุงููููู</button>
        <button id="expandAll" class="btn">ูุชุญ ุงููู</button>
        <button id="collapseAll" class="btn ghost">ุฅุบูุงู ุงููู</button>
        <button id="printBtn" class="btn ghost" title="ุทุจุงุนุฉ / PDF">ุทุจุงุนุฉ</button>
      </div>
    </div>
  </header>

  <div class="shell">
    <aside class="sidebar">
      <h2>ุจุญุซ ูุชูุธูู</h2>
      <div class="group">
        <div class="input">
          <input id="q" type="search" placeholder="ุงุจุญุซ ุจุงูุงุณู (ูุซุงู: ุฃุญูุฏุ ุนุจุฏ ุงูุญุณูุจุ ุฎุงูุฏ)">
        </div>
        <div class="chips">
          <span id="clearBtn" class="chip">ูุณุญ</span>
          <span id="rootOpenBtn" class="chip">ูุชุญ ุงูุฌุฐุฑ ููุท</span>
          <span id="collapseTo2" class="chip">ูุชุญ ุญุชู ุงููุณุชูู 2</span>
        </div>
        <p class="hint mobile-hide">ุงูุจุญุซ ุฐูู: ููุญูุฏ ุงูุฃูู/ุงููุงุกุ ูุชุฌุงูู ุงูุชุดููู ูููุธูุฑ ุงูุขุจุงุก ุนูุฏ ุชุทุงุจู ุงูุฃุจูุงุก. ุงุฎุชุตุงุฑ: <span class="kbd mobile-hide">Ctrl</span> + <span class="kbd mobile-hide">F</span> ูุจุญุซ ุงููุชุตูุญ ุฃู ุงุณุชุฎุฏู ุงูุญูู ุฃุนูุงู.</p>
      </div>

      <div class="group">
        <h2 class="mobile-hide">ูุณุงุฑ ุงููููุณูุจ</h2>
        <div id="breadcrumbs" class="breadcrumbs" aria-live="polite"></div>
        <p class="hint mobile-hide">ุงููุฑ ุนูู ุฃู ุงุณู ูุฅุธูุงุฑ ูุณุงุฑู ูู ุงูุฌุฐุฑ.</p>
      </div>
    </aside>

    <main class="content">
      <div class="stats">
        <div class="stat">ุนุฏุฏ ุงููุฑูุน: <span id="nodeCount">โ</span></div>
        <div class="stat">ุงููุณุชูู ุงูููุชูุญ: <span id="openDepth">โ</span></div>
      </div>
      <p class="hint">ุงุถุบุท ุนูู ุงูุงุณู ููุชุญ/ุฅุบูุงู ุงูุฃุจูุงุก.</p>

      <ul id="tree" class="tree">
        <li class="node expanded" data-name="ุงุจุฑุงููู ูู">
          <div class="label"><span class="caret"></span><span class="name">ุงุจุฑุงููู ูู</span></div>
          <ul class="children">

            <li class="node expanded" data-name="ุฎุงูุฏ ุจูู ูู">
              <div class="label"><span class="caret"></span><span class="name">ุฎุงูุฏ ุจูู ูู</span></div>
              <ul class="children">

                <li class="node" data-name="ุณุนุฏ ูู">
                  <div class="label"><span class="caret"></span><span class="name">ุณุนุฏ ูู</span></div>
                  <ul class="children">

                    <li data-name="ูุงุฑูู ุณุนุฏ ูู"><div class="label"><span class="name">ูุงุฑูู ุณุนุฏ ูู</span></div></li>
                    <li class="node" data-name="ุนุฏูุงู ุณุนุฏ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ุนุฏูุงู ุณุนุฏ ูู</span></div>
                      <ul class="children">
                        <li class="node" data-name="ูููุฏ ุนุฏูุงู ูู">
                          <div class="label"><span class="caret"></span><span class="name">ูููุฏ ุนุฏูุงู ูู</span></div>
                          <ul class="children">
                            <li data-name="ุฌุงุฏ ูููุฏ ูู"><div class="label"><span class="name">ุฌุงุฏ ูููุฏ ูู</span></div></li>
                          </ul>
                        </li>
                        <li data-name="ุณุนูุฏ ุนุฏูุงู ูู"><div class="label"><span class="name">ุณุนูุฏ ุนุฏูุงู ูู</span></div></li>
                        <li data-name="ุจุณุงู ุนุฏูุงู ูู"><div class="label"><span class="name">ุจุณุงู ุนุฏูุงู ูู</span></div></li>
                        <li data-name="ุบุณุงู ุนุฏูุงู ูู"><div class="label"><span class="name">ุบุณุงู ุนุฏูุงู ูู</span></div></li>
                      </ul>
                    </li>

                    <li class="node" data-name="ุบุงุฒู ุณุนุฏ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ุบุงุฒู ุณุนุฏ ูู</span></div>
                      <ul class="children">
                        <li class="node" data-name="ุดุงุฏู ุบุงุฒู ูู">
                          <div class="label"><span class="caret"></span><span class="name">ุดุงุฏู ุบุงุฒู ูู</span></div>
                          <ul class="children">
                            <li data-name="ุฌูุฏ ุดุงุฏู ูู"><div class="label"><span class="name">ุฌูุฏ ุดุงุฏู ูู</span></div></li>
                          </ul>
                        </li>
                      </ul>
                    </li>

                    <li class="node" data-name="ูููู ุณุนุฏ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ูููู ุณุนุฏ ูู</span></div>
                      <ul class="children">
                        <li class="node" data-name="ุนุตุงู ูููู ูู">
                          <div class="label"><span class="caret"></span><span class="name">ุนุตุงู ูููู ูู</span></div>
                          <ul class="children">
                            <li data-name="ุทูุงู ุนุตุงู ูู"><div class="label"><span class="name">ุทูุงู ุนุตุงู ูู</span></div></li>
                            <li data-name="ูุตู ุนุตุงู ูู"><div class="label"><span class="name">ูุตู ุนุตุงู ูู</span></div></li>
                          </ul>
                        </li>

                        <li class="node" data-name="ุนูุงุก ูููู ูู">
                          <div class="label"><span class="caret"></span><span class="name">ุนูุงุก ูููู ูู</span></div>
                          <ul class="children">
                            <li data-name="ุนุจุฏ ุงููุทูู ุนูุงุก ูู"><div class="label"><span class="name">ุนุจุฏ ุงููุทูู ุนูุงุก ูู</span></div></li>
                            <li data-name="ุนูู ุนูุงุก ูู"><div class="label"><span class="name">ุนูู ุนูุงุก ูู</span></div></li>
                          </ul>
                        </li>
                        <li class="node" data-name="ุนุงูุฑ ูููู ูู">
                          <div class="label"><span class="caret"></span><span class="name">ุนุงูุฑ ูููู ูู</span></div>
                          <ul class="children">
                            <li data-name="ูุงุฑูู ุนุงูุฑ ูู"><div class="label"><span class="name">ูุงุฑูู ุนุงูุฑ ูู</span></div></li>
                          </ul>
                        </li>

                      </ul>
                    </li>


                    <li class="node" data-name="ุฃููู ุณุนุฏ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ุฃููู ุณุนุฏ ูู</span></div>
                      <ul class="children">
                        <li data-name="ูุญูุฏ ุฑุงุณู ุฃููู ูู"><div class="label"><span class="name">ูุญูุฏ ุฑุงุณู ุฃููู ูู</span></div></li>
                        <li data-name="ุฃุญูุฏ ุฃููู ูู"><div class="label"><span class="name">ุฃุญูุฏ ุฃููู ูู</span></div></li>
                        <li data-name="ุถูุงุก ุฃููู ูู"><div class="label"><span class="name">ุถูุงุก ุฃููู ูู</span></div></li>
                      </ul>
                    </li>

                    <li class="node" data-name="ุฎุงูุฏ ุณุนุฏ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ุฎุงูุฏ ุณุนุฏ ูู</span></div>
                      <ul class="children">
                        <li class="node" data-name="ูููุฏ ุฎุงูุฏ ูู">
                          <div class="label"><span class="caret"></span><span class="name">ูููุฏ ุฎุงูุฏ ูู</span></div>
                          <ul class="children">
                            <li data-name="ุฎุงูุฏ ูููุฏ ูู"><div class="label"><span class="name">ุฎุงูุฏ ูููุฏ ูู</span></div></li>
                            <li data-name="ูููุฏ ูููุฏ ูู"><div class="label"><span class="name">ูููุฏ ูููุฏ ูู</span></div></li>
                          </ul>
                        </li>
                        <li data-name="ูููุฏ ุฎุงูุฏ ูู"><div class="label"><span class="name">ูููุฏ ุฎุงูุฏ ูู</span></div></li>
                      </ul>
                    </li>

                    <li class="node" data-name="ุนูุฑ ุณุนุฏ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ุนูุฑ ุณุนุฏ ูู</span></div>
                      <ul class="children">
                        <li data-name="ุฅุจุฑุงููู ุนูุฑ ูู"><div class="label"><span class="name">ุฅุจุฑุงููู ุนูุฑ ูู</span></div></li>
                        <li data-name="ุฅุณูุงุนูู ุนูุฑ ูู"><div class="label"><span class="name">ุฅุณูุงุนูู ุนูุฑ ูู</span></div></li>
                        <li data-name="ููุณู ุนูุฑ ูู"><div class="label"><span class="name">ููุณู ุนูุฑ ูู</span></div></li>
                      </ul>
                    </li>

                    <li class="node" data-name="ุฑูุงุถ ุณุนุฏ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ุฑูุงุถ ุณุนุฏ ูู</span></div>
                      <ul class="children">
                        <li data-name="ูุงุฆู ุฑูุงุถ ูู"><div class="label"><span class="name">ูุงุฆู ุฑูุงุถ ูู</span></div></li>
                      </ul>
                    </li>

                  </ul>
                </li>

                <li class="node" data-name="ุนุจุฏ ุงูุญุณูุจ ูู">
                  <div class="label"><span class="caret"></span><span class="name">ุนุจุฏ ุงูุญุณูุจ ูู</span></div>
                  <ul class="children">
                    <li class="node" data-name="ูุงุตุฑ ุนุจุฏ ุงูุญุณูุจ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ูุงุตุฑ ุนุจุฏ ุงูุญุณูุจ ูู</span></div>
                      <ul class="children">
                        <li data-name="ูุญูู ูุงุตุฑ ูู"><div class="label"><span class="name">ูุญูู ูุงุตุฑ ูู</span></div></li>
                        <li class="node" data-name="ููุฑ ูุงุตุฑ ูู">
                          <div class="label"><span class="caret"></span><span class="name">ููุฑ ูุงุตุฑ ูู</span></div>
                          <ul class="children">
                            <li data-name="ูุงุตุฑ ููุฑ ูู"><div class="label"><span class="name">ูุงุตุฑ ููุฑ ูู</span></div></li>
                            <li data-name="ูุญููุฏ ููุฑ ูู"><div class="label"><span class="name">ูุญููุฏ ููุฑ ูู</span></div></li>
                            <li data-name="ุฃุญูุฏ ููุฑ ูู"><div class="label"><span class="name">ุฃุญูุฏ ููุฑ ูู</span></div></li>
                          </ul>
                        </li>
                      </ul>
                    </li>

                    <li class="node" data-name="ูุงุณุฑ ุนุจุฏ ุงูุญุณูุจ ูู">
                      <div class="label"><span class="caret"></span><span class="name">ูุงุณุฑ ุนุจุฏ ุงูุญุณูุจ ูู</span></div>
                      <ul class="children">

                        <li class="node" data-name="ุนุจุฏ ุงูุญุณูุจ ูุงุณุฑ ูู">
                          <div class="label"><span class="caret"></span><span class="name">ุนุจุฏ ุงูุญุณูุจ ูุงุณุฑ ูู</span></div>
                          <ul class="children">
                            <li data-name="ูุงุณุฑ ุนุจุฏ ุงูุญุณูุจ ูู"><div class="label"><span class="name">ูุงุณุฑ ุนุจุฏ ุงูุญุณูุจ ูู</span></div></li>
                            <li data-name="ูุตุทูู ุนุจุฏ ุงูุญุณูุจ ูู"><div class="label"><span class="name">ูุตุทูู ุนุจุฏ ุงูุญุณูุจ ูู</span></div></li>
                            <li data-name="ุฒูู ุนุจุฏ ุงูุญุณูุจ ูู"><div class="label"><span class="name">ุฒูู ุนุจุฏ ุงูุญุณูุจ ูู</span></div></li>
                          </ul>
                        </li>

                        <li class="node" data-name="ุญุณุงู ูุงุณุฑ ูู">
                          <div class="label"><span class="caret"></span><span class="name">ุญุณุงู ูุงุณุฑ ูู</span></div>
                          <ul class="children">
                            <li data-name="ุฃููู ุญุณุงู ูู"><div class="label"><span class="name">ุฃููู ุญุณุงู ูู</span></div></li>
                          </ul>
                        </li>

                        <li class="node" data-name="ุจุดุงุฑ ูุงุณุฑ ูู">
                          <div class="label"><span class="caret"></span><span class="name">ุจุดุงุฑ ูุงุณุฑ ูู</span></div>
                          <ul class="children">
                            <li data-name="ูุฒู ุจุดุงุฑ ูู"><div class="label"><span class="name">ูุฒู ุจุดุงุฑ ูู</span></div></li>
                          </ul>
                        </li>

                        <li class="node" data-name="ุญุณุงู ูุงุณุฑ ูู">
                          <div class="label"><span class="caret"></span><span class="name">ุญุณุงู ูุงุณุฑ ูู</span></div>
                          <ul class="children">
                            <li data-name="ูุงูุฑ ุญุณุงู ูู"><div class="label"><span class="name">ูุงูุฑ ุญุณุงู ูู</span></div></li>
                          </ul>
                        </li>

                        <li data-name="ุฃูุณ ูุงุณุฑ ูู"><div class="label"><span class="name">ุฃูุณ ูุงุณุฑ ูู</span></div></li>
                        <li data-name="ูุญูุฏ ูุงุณุฑ ูู"><div class="label"><span class="name">ูุญูุฏ ูุงุณุฑ ูู</span></div></li>

                      </ul>
                    </li>
                  </ul>
                </li>

                <li data-name="ุนุจุฏ ุงููุฑูู ูู"><div class="label"><span class="name">ุนุจุฏ ุงููุฑูู ูู</span></div></li>


              </ul>
            </li>

          </ul>
        </li>
      </ul>
    
    <div id="infoBox" class="info-box"></div>
    </main>

  </div>

  <footer class="app">
    <p>ูุฐุง ุงููููุน ูุณุฎุฉ ูุญุณููุฉ ุจุตุฑููุง ุนู ุงูุดุฌุฑุฉ ุงูุชูุงุนููุฉ ุงูุฃุตููุฉ ูุน ุจุญุซ ุนุฑุจู ุฐูู ููุถุน ูููู/ููุงุฑู ูุทุจุงุนุฉ ุณููุฉ.</p>
  </footer>

  <script>
    // Theme toggle (persist)
    const root = document.documentElement;
    const themeBtn = document.getElementById('themeBtn');
    function applyTheme(t){ document.body.setAttribute('data-theme', t); localStorage.setItem('fam-theme', t); themeBtn.textContent = (t==='dark' ? 'ุงููุถุน ุงูููุงุฑู' : 'ุงููุถุน ุงููููู'); }
    applyTheme(localStorage.getItem('fam-theme') || 'dark');
    themeBtn.addEventListener('click', ()=> applyTheme(document.body.getAttribute('data-theme')==='dark'?'light':'dark'));

    // Expand/collapse handlers
    document.addEventListener('click', function(e){
      const lbl = e.target.closest('.label');
      if(!lbl) return;
      const li = lbl.closest('li');
      if(li && li.classList.contains('node')){
        li.classList.toggle('expanded');
        updateOpenDepth();
        updateBreadcrumbs(li);
      } else if(li){
        updateBreadcrumbs(li);
      }
    });
    document.getElementById('expandAll').addEventListener('click', ()=>{
      document.querySelectorAll('.node').forEach(n => n.classList.add('expanded'));
      updateOpenDepth();
    });
    document.getElementById('collapseAll').addEventListener('click', ()=>{
      document.querySelectorAll('.node').forEach(n => n.classList.remove('expanded'));
      const root = document.querySelector('#tree > li.node');
      if(root) root.classList.add('expanded');
      updateOpenDepth();
    });
    document.getElementById('rootOpenBtn').addEventListener('click', ()=>{
      document.querySelectorAll('.node').forEach(n => n.classList.remove('expanded'));
      const root = document.querySelector('#tree > li.node');
      if(root) root.classList.add('expanded');
      updateOpenDepth();
    });
    document.getElementById('collapseTo2').addEventListener('click', ()=>{
      // expand root and its direct children only
      document.querySelectorAll('.node').forEach(n => n.classList.remove('expanded'));
      const root = document.querySelector('#tree > li.node');
      if(!root) return;
      root.classList.add('expanded');
      root.querySelectorAll(':scope > .children > li.node').forEach(n => n.classList.add('expanded'));
      updateOpenDepth();
    });

    // Search: Arabic normalization + highlight + keep ancestors expanded + count
    const q = document.getElementById('q');
    const clearBtn = document.getElementById('clearBtn');
    function removeMarks(){ document.querySelectorAll('.name').forEach(n => { n.innerHTML = n.textContent; }); }
    function ensureAncestorsExpanded(li){
      let p = li.parentElement;
      while(p){
        const owner = p.closest('li');
        if(owner && owner.classList.contains('node')){
          owner.classList.add('expanded');
          p = owner.parentElement;
        } else { p = null; }
      }
    }
    function normalize(text) {
      return text
        .replace(/[ุฃุฅุขุง]/g, 'ุง')
        .replace(/ู/g, 'ู')
        .replace(/ุฉ/g, 'ู')
        .replace(/[\u064B-\u0652\u0670]/g, '')
        .replace(/\s+/g, ' ')
        .trim().toLowerCase();
    }
    function buildArabicPattern(str){
      const diac = '[\\u064B-\\u0652\\u0670]*';
      const map = { 'ุง':'[ุงุฃุฅุขุง]', 'ุฃ':'[ุงุฃุฅุขุง]', 'ุฅ':'[ุงุฃุฅุขุง]', 'ุข':'[ุงุฃุฅุขุง]', 'ู':'[ูู]', 'ู':'[ูู]', 'ุฉ':'[ุฉู]', 'ู':'[ูุฉ]' };
      function esc(ch){ return /[.*+?^${}()|[\]\\]/.test(ch) ? '\\' + ch : ch; }
      let out = '';
      for(const ch of str.trim()){
        if(/\s/.test(ch)){ out += '\\s+'; }
        else if(map[ch]){ out += map[ch] + diac; }
        else { out += esc(ch) + diac; }
      }
      return new RegExp(out, 'gi');
    }
    function highlightText(el, tokens){
      const raw = el.textContent;
      if(!tokens.length) { el.innerHTML = raw; return; }
      const patterns = tokens.filter(Boolean).map(buildArabicPattern);
      let html = raw;
      for(const re of patterns){
        html = html.replace(/<\/?mark>/g, '');
        html = html.replace(re, (m) => `<mark>${m}</mark>`);
      }
      el.innerHTML = html;
    }
    function walkAndFilter(li, tokens){
      const nameEl = li.querySelector(':scope > .label .name');
      const ownRaw = nameEl ? nameEl.textContent : '';
      const ownNorm = ownRaw ? normalize(ownRaw) : '';
      const ownMatch = tokens.length ? tokens.every(t => ownNorm.includes(normalize(t))) : true;
      const childrenUL = li.querySelector(':scope > .children');
      let childMatch = false;
      if(childrenUL){
        const childLis = childrenUL.querySelectorAll(':scope > li');
        childMatch = Array.from(childLis).map(c => walkAndFilter(c, tokens)).some(Boolean);
      }
      const matched = ownMatch || childMatch;
      li.style.display = matched ? '' : 'none';
      if(ownMatch && nameEl && tokens.length){
        highlightText(nameEl, tokens);
        ensureAncestorsExpanded(li);
      }
      return matched;
    }
    function filterTree(term){
      removeMarks();
      const root = document.querySelector('#tree > li');
      if(!root) return;
      if(!term.trim()){
        document.querySelectorAll('#tree li').forEach(li => li.style.display = '');
        updateStats();
        return;
      }
      const tokens = term.split(/\s+/).map(t => t.trim()).filter(Boolean);
      walkAndFilter(root, tokens);
      updateStats();
    }
    q.addEventListener('input', ()=> filterTree(q.value));
    clearBtn.addEventListener('click', ()=>{ q.value=''; filterTree(''); });

    // Breadcrumbs
    const bc = document.getElementById('breadcrumbs');
    function updateBreadcrumbs(li){
      const parts = [];
      let cur = li;
      while(cur && cur.matches('li')){
        const nm = cur.querySelector(':scope > .label .name');
        if(nm){ parts.push(nm.textContent.trim()); }
        cur = cur.parentElement.closest('li');
      }
      parts.reverse();
      bc.innerHTML = parts.map((p,i)=> `<span class="crumb">${p}</span>`).join('');
    }

    // Stats
    function updateStats(){
      const total = document.querySelectorAll('#tree li').length;
      document.getElementById('nodeCount').textContent = total.toLocaleString('ar');
      updateOpenDepth();
    }
    function updateOpenDepth(){
      // compute deepest expanded level (root = 1)
      const root = document.querySelector('#tree > li.node');
      if(!root){ document.getElementById('openDepth').textContent = 'โ'; return; }
      let maxDepth = 1;
      function depth(li, d){
        maxDepth = Math.max(maxDepth, d);
        li.querySelectorAll(':scope > .children > li').forEach(c => depth(c, d+1));
      }
      depth(root, 1);
      document.getElementById('openDepth').textContent = maxDepth.toString();
    }
    updateStats();

    
// Show info for Diaa Ayman
document.addEventListener('click', function(e){
  const nameEl = e.target.closest('.name');
  const infoBox = document.getElementById('infoBox');
  if(!nameEl) return;
  const text = nameEl.textContent.trim();
  if(text === 'ุถูุงุก ุฃููู ูู'){
    infoBox.innerHTML = `
      <h3>๐จโ๐ป ุงููููุฏุณ ุถูุงุก ุฃููู ูู</h3>
      <p>ุฃูู ูููุฏุณ ูุนูููุงุชูุฉ ูู ุนุงุฆูุฉ ูู</p>
      <p>๐ ุฎุฑูุฌ ุฌุงูุนุฉ ุฏูุดู โ ููุงููุฏ <strong>1998</strong></p>
      <p>๐ ุนุงุด ูู ุฏูุดู ูุงูุชูู ุฅูู ุฏุจู ุนุงู 2022</p>
      <p>๐ ูุณุชูุฑ ูููุง ุญุชู ุงูุขู</p>
    `;
    infoBox.style.display = 'block';
    infoBox.scrollIntoView({ behavior: 'smooth' });
  } else {
    if(!e.target.closest('#infoBox')) infoBox.style.display = 'none';
  }
});

    // Print
    document.getElementById('printBtn').addEventListener('click', ()=> window.print());
  
// Unified info box for Diaa & Ahmad (same design and behavior)
document.addEventListener('click', function(e){
  const nameEl = e.target.closest('.name');
  const infoBox = document.getElementById('infoBox');
  if(!nameEl) return;
  const text = nameEl.textContent.trim();

  if(text === 'ุถูุงุก ุฃููู ูู'){
    infoBox.innerHTML = `
      <h3>๐จโ๐ป ุงููููุฏุณ ุถูุงุก ุฃููู ูู</h3>
      <p>ุฃูู ูููุฏุณ ูุนูููุงุชูุฉ ูู ุนุงุฆูุฉ ูู</p>
      <p>๐ ุฎุฑูุฌ ุฌุงูุนุฉ ุฏูุดู โ ููุงููุฏ <strong>1998</strong></p>
      <p>๐ ุนุงุด ูู ุฏูุดู ูุงูุชูู ุฅูู ุฏุจู ุนุงู 2022</p>
      <p>๐ ูุณุชูุฑ ูููุง ุญุชู ุงูุขู</p>
    `;
    infoBox.style.display = 'block';
    infoBox.scrollIntoView({ behavior: 'smooth' });
  } else if(text === 'ุฃุญูุฏ ุฃููู ูู'){
    infoBox.innerHTML = `
      <h3>๐จโ๐ฌ ุฃุญูุฏ ุฃููู ูู</h3>
      <p>ููุงููุฏ <strong>1992</strong></p>
      <p>๐ ุนุงุด ูู <strong>ุฏูุดู</strong> ูุณุงูุฑ ุฅูู <strong>ุฃููุงููุง</strong> ุนุงู <strong>2015</strong></p>
      <p>๐ ุฏุฑุณ <strong>ุงูููููุงุก</strong> ูู <strong>ุฌุงูุนุฉ ุชุดุฑูู โ ุงููุงุฐููุฉ</strong></p>
    `;
    infoBox.style.display = 'block';
    infoBox.scrollIntoView({ behavior: 'smooth' });
  }
});

</script>
</body>
</html>
