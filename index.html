<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>شجرة عائلة لك — موقع تفاعلي</title>
  <meta name="description" content="موقع تفاعلي جميل ومرتب لعرض شجرة عائلة لك مع بحث ذكي، وضع ليلي، وأدوات تنقل.">
  <style>
    :root{
      --bg: #0b1016;
      --panel: #0f1620;
      --muted: #a0b3c5;
      --text: #eef3f8;
      --accent: #4cc9f0;
      --accent-2: #a6e3a1;
      --border: #1d2936;
      --chip: #152231;
      --mark: #ffde8a;
      --shadow: 0 6px 24px rgba(0,0,0,.25);
    }
    [data-theme="light"]{
      --bg:#f6f7fb; --panel:#ffffff; --text:#0f172a; --muted:#42536a; --accent:#2563eb;
      --accent-2:#059669; --border:#e5e7eb; --chip:#f1f5f9; --shadow:0 8px 24px rgba(2,6,23,.08);
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.7 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Naskh Arabic","Amiri",Tahoma,Arial,sans-serif;}
    .shell{display:grid;grid-template-columns: 290px 1fr; gap:16px; max-width:1200px; margin:0 auto; padding:18px;}
    header.app{
      position:sticky; top:0; z-index:40;
      background:linear-gradient(180deg, rgba(0,0,0,.22), transparent);
      backdrop-filter: blur(6px);
      padding:12px 18px; border-bottom:1px solid var(--border);
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:36px;height:36px;border-radius:10px;
      background: radial-gradient(120px 50px at 70% 20%, var(--accent), transparent),
                  radial-gradient(120px 60px at 0% 120%, var(--accent-2), transparent),
                  radial-gradient(80px 30px at 100% 100%, #f59e0b, transparent);
      box-shadow: var(--shadow); border:1px solid var(--border);
    }
    .brand h1{font-size:18px;margin:0}
    .bar{display:flex;justify-content:space-between;align-items:center;gap:12px;max-width:1200px;margin:0 auto}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--border); background:var(--panel); color:var(--text);
      padding:8px 12px;border-radius:12px;cursor:pointer; box-shadow:var(--shadow);
    }
    .btn:hover{border-color:var(--accent);}
    .btn.secondary{background:var(--chip)}
    .btn.ghost{background:transparent;border-color:var(--border)}
    .sidebar{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow);height:max-content;position:sticky;top:70px}
    .sidebar h2{margin:6px 0 12px 0;font-size:16px;color:var(--muted)}
    .group{display:grid;gap:8px;margin-bottom:14px}
    .input{display:flex;gap:8px}
    .input input[type="search"]{flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--chip);color:var(--text)}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--border);background:var(--chip);color:var(--text);padding:6px 10px;border-radius:999px;cursor:pointer}
    .chip.active{outline:2px solid var(--accent)}
    .content{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .hint{color:var(--muted);font-size:14px;margin-bottom:10px}
    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .stat{background:var(--chip);border:1px solid var(--border);border-radius:12px;padding:8px 10px;color:var(--muted);font-size:14px}
    .tree{list-style:none;margin:0;padding:0}
    .tree, .tree ul{margin:0;padding:0}
    .tree li{list-style:none;position:relative;margin:6px 0;padding:8px 12px;border:1px solid var(--border);background:var(--chip);border-radius:12px}
    .label{display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none}
    .name{font-weight:600}
    .caret{width:0;height:0;border-top:6px solid transparent;border-bottom:6px solid transparent;border-right:8px solid var(--muted);transition:transform .2s ease}
    .node.expanded>.label .caret{transform:rotate(-90deg)}
    .children{margin:8px 18px 0 0;display:none}
    .node.expanded>.children{display:block}
    .breadcrumbs{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0}
    .crumb{background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:14px}
    mark{background:var(--mark);padding:0 2px;border-radius:3px}
    footer.app{max-width:1200px;margin:16px auto 28px auto;color:var(--muted);padding:0 18px;font-size:13px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:var(--chip);border:1px solid var(--border);border-radius:6px;padding:2px 6px}
    @media (max-width: 980px){
      .shell{grid-template-columns: 1fr; padding:12px}
      .sidebar{position:relative;top:auto}
    }
  </style>
</head>
<body data-theme="dark">
  <header class="app">
    <div class="bar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>شجرة عائلة لك — موقع تفاعلي</h1>
      </div>
      <div class="actions">
        <button id="themeBtn" class="btn secondary" title="تبديل الوضع">الوضع الليلي</button>
        <button id="expandAll" class="btn">فتح الكل</button>
        <button id="collapseAll" class="btn ghost">إغلاق الكل</button>
        <button id="printBtn" class="btn ghost" title="طباعة / PDF">طباعة</button>
      </div>
    </div>
  </header>

  <div class="shell">
    <aside class="sidebar">
      <h2>بحث وتنظيم</h2>
      <div class="group">
        <div class="input">
          <input id="q" type="search" placeholder="ابحث بالاسم (مثال: أحمد، عبد الحسيب، خالد)">
        </div>
        <div class="chips">
          <span id="clearBtn" class="chip">مسح</span>
          <span id="rootOpenBtn" class="chip">فتح الجذر فقط</span>
          <span id="collapseTo2" class="chip">فتح حتى المستوى 2</span>
        </div>
        <p class="hint">البحث ذكي: يوحّد الألف/الياء، يتجاهل التشكيل ويُظهر الآباء عند تطابق الأبناء. اختصار: <span class="kbd">Ctrl</span> + <span class="kbd">F</span> لبحث المتصفح أو استخدم الحقل أعلاه.</p>
      </div>

      <div class="group">
        <h2>مسار النَّسَب</h2>
        <div id="breadcrumbs" class="breadcrumbs" aria-live="polite"></div>
        <p class="hint">انقر على أي اسم لإظهار مساره من الجذر.</p>
      </div>
    </aside>

    <main class="content">
      <div class="stats">
        <div class="stat">عدد الفروع: <span id="nodeCount">—</span></div>
        <div class="stat">المستوى المفتوح: <span id="openDepth">—</span></div>
      </div>
      <p class="hint">اضغط على الاسم لفتح/إغلاق الأبناء.</p>

      <ul id="tree" class="tree">
        <li class="node expanded" data-name="ابراهيم لك">
          <div class="label"><span class="caret"></span><span class="name">ابراهيم لك</span></div>
          <ul class="children">

            <li class="node expanded" data-name="خالد بيك لك">
              <div class="label"><span class="caret"></span><span class="name">خالد بيك لك</span></div>
              <ul class="children">

                <li class="node" data-name="سعد لك">
                  <div class="label"><span class="caret"></span><span class="name">سعد لك</span></div>
                  <ul class="children">

                    <li data-name="فاروق سعد لك"><div class="label"><span class="name">فاروق سعد لك</span></div></li>
                    <li class="node" data-name="عدنان سعد لك">
                      <div class="label"><span class="caret"></span><span class="name">عدنان سعد لك</span></div>
                      <ul class="children">
                        <li class="node" data-name="وليد عدنان لك">
                          <div class="label"><span class="caret"></span><span class="name">وليد عدنان لك</span></div>
                          <ul class="children">
                            <li data-name="جاد وليد لك"><div class="label"><span class="name">جاد وليد لك</span></div></li>
                          </ul>
                        </li>
                        <li data-name="سعيد عدنان لك"><div class="label"><span class="name">سعيد عدنان لك</span></div></li>
                        <li data-name="بسام عدنان لك"><div class="label"><span class="name">بسام عدنان لك</span></div></li>
                        <li data-name="غسان عدنان لك"><div class="label"><span class="name">غسان عدنان لك</span></div></li>
                      </ul>
                    </li>

                    <li class="node" data-name="غازي سعد لك">
                      <div class="label"><span class="caret"></span><span class="name">غازي سعد لك</span></div>
                      <ul class="children">
                        <li class="node" data-name="شادي غازي لك">
                          <div class="label"><span class="caret"></span><span class="name">شادي غازي لك</span></div>
                          <ul class="children">
                            <li data-name="جود شادي لك"><div class="label"><span class="name">جود شادي لك</span></div></li>
                          </ul>
                        </li>
                      </ul>
                    </li>

                    <li class="node" data-name="فهيم سعد لك">
                      <div class="label"><span class="caret"></span><span class="name">فهيم سعد لك</span></div>
                      <ul class="children">
                        <li class="node" data-name="عصام فهيم لك">
                          <div class="label"><span class="caret"></span><span class="name">عصام فهيم لك</span></div>
                          <ul class="children">
                            <li data-name="طلال عصام لك"><div class="label"><span class="name">طلال عصام لك</span></div></li>
                            <li data-name="قصي عصام لك"><div class="label"><span class="name">قصي عصام لك</span></div></li>
                          </ul>
                        </li>

                        <li class="node" data-name="علاء فهيم لك">
                          <div class="label"><span class="caret"></span><span class="name">علاء فهيم لك</span></div>
                          <ul class="children">
                            <li data-name="عبد اللطيف علاء لك"><div class="label"><span class="name">عبد اللطيف علاء لك</span></div></li>
                            <li data-name="علي علاء لك"><div class="label"><span class="name">علي علاء لك</span></div></li>
                          </ul>
                        </li>
                        <li class="node" data-name="عامر فهيم لك">
                          <div class="label"><span class="caret"></span><span class="name">عامر فهيم لك</span></div>
                          <ul class="children">
                            <li data-name="فاروق عامر لك"><div class="label"><span class="name">فاروق عامر لك</span></div></li>
                          </ul>
                        </li>

                      </ul>
                    </li>


                    <li class="node" data-name="أيمن سعد لك">
                      <div class="label"><span class="caret"></span><span class="name">أيمن سعد لك</span></div>
                      <ul class="children">
                        <li data-name="محمد راسم أيمن لك"><div class="label"><span class="name">محمد راسم أيمن لك</span></div></li>
                        <li data-name="أحمد أيمن لك"><div class="label"><span class="name">أحمد أيمن لك</span></div></li>
                        <li data-name="ضياء أيمن لك"><div class="label"><span class="name">ضياء أيمن لك</span></div></li>
                      </ul>
                    </li>

                    <li class="node" data-name="خالد سعد لك">
                      <div class="label"><span class="caret"></span><span class="name">خالد سعد لك</span></div>
                      <ul class="children">
                        <li class="node" data-name="وليد خالد لك">
                          <div class="label"><span class="caret"></span><span class="name">وليد خالد لك</span></div>
                          <ul class="children">
                            <li data-name="خالد وليد لك"><div class="label"><span class="name">خالد وليد لك</span></div></li>
                            <li data-name="مهند وليد لك"><div class="label"><span class="name">مهند وليد لك</span></div></li>
                          </ul>
                        </li>
                        <li data-name="مهند خالد لك"><div class="label"><span class="name">مهند خالد لك</span></div></li>
                      </ul>
                    </li>

                    <li class="node" data-name="عمر سعد لك">
                      <div class="label"><span class="caret"></span><span class="name">عمر سعد لك</span></div>
                      <ul class="children">
                        <li data-name="إبراهيم عمر لك"><div class="label"><span class="name">إبراهيم عمر لك</span></div></li>
                        <li data-name="إسماعيل عمر لك"><div class="label"><span class="name">إسماعيل عمر لك</span></div></li>
                        <li data-name="يوسف عمر لك"><div class="label"><span class="name">يوسف عمر لك</span></div></li>
                      </ul>
                    </li>

                    <li class="node" data-name="رياض سعد لك">
                      <div class="label"><span class="caret"></span><span class="name">رياض سعد لك</span></div>
                      <ul class="children">
                        <li data-name="وائل رياض لك"><div class="label"><span class="name">وائل رياض لك</span></div></li>
                      </ul>
                    </li>

                  </ul>
                </li>

                <li class="node" data-name="عبد الحسيب لك">
                  <div class="label"><span class="caret"></span><span class="name">عبد الحسيب لك</span></div>
                  <ul class="children">
                    <li class="node" data-name="ناصر عبد الحسيب لك">
                      <div class="label"><span class="caret"></span><span class="name">ناصر عبد الحسيب لك</span></div>
                      <ul class="children">
                        <li data-name="يحيى ناصر لك"><div class="label"><span class="name">يحيى ناصر لك</span></div></li>
                        <li class="node" data-name="نور ناصر لك">
                          <div class="label"><span class="caret"></span><span class="name">نور ناصر لك</span></div>
                          <ul class="children">
                            <li data-name="ناصر نور لك"><div class="label"><span class="name">ناصر نور لك</span></div></li>
                            <li data-name="محمود نور لك"><div class="label"><span class="name">محمود نور لك</span></div></li>
                            <li data-name="أحمد نور لك"><div class="label"><span class="name">أحمد نور لك</span></div></li>
                          </ul>
                        </li>
                      </ul>
                    </li>

                    <li class="node" data-name="ياسر عبد الحسيب لك">
                      <div class="label"><span class="caret"></span><span class="name">ياسر عبد الحسيب لك</span></div>
                      <ul class="children">

                        <li class="node" data-name="عبد الحسيب ياسر لك">
                          <div class="label"><span class="caret"></span><span class="name">عبد الحسيب ياسر لك</span></div>
                          <ul class="children">
                            <li data-name="ياسر عبد الحسيب لك"><div class="label"><span class="name">ياسر عبد الحسيب لك</span></div></li>
                            <li data-name="مصطفى عبد الحسيب لك"><div class="label"><span class="name">مصطفى عبد الحسيب لك</span></div></li>
                            <li data-name="زين عبد الحسيب لك"><div class="label"><span class="name">زين عبد الحسيب لك</span></div></li>
                          </ul>
                        </li>

                        <li class="node" data-name="حسام ياسر لك">
                          <div class="label"><span class="caret"></span><span class="name">حسام ياسر لك</span></div>
                          <ul class="children">
                            <li data-name="أيهم حسام لك"><div class="label"><span class="name">أيهم حسام لك</span></div></li>
                          </ul>
                        </li>

                        <li class="node" data-name="بشار ياسر لك">
                          <div class="label"><span class="caret"></span><span class="name">بشار ياسر لك</span></div>
                          <ul class="children">
                            <li data-name="يزن بشار لك"><div class="label"><span class="name">يزن بشار لك</span></div></li>
                          </ul>
                        </li>

                        <li class="node" data-name="حسان ياسر لك">
                          <div class="label"><span class="caret"></span><span class="name">حسان ياسر لك</span></div>
                          <ul class="children">
                            <li data-name="ماهر حسان لك"><div class="label"><span class="name">ماهر حسان لك</span></div></li>
                          </ul>
                        </li>

                        <li data-name="أنس ياسر لك"><div class="label"><span class="name">أنس ياسر لك</span></div></li>
                        <li data-name="محمد ياسر لك"><div class="label"><span class="name">محمد ياسر لك</span></div></li>

                      </ul>
                    </li>
                  </ul>
                </li>

                <li data-name="عبد الكريم لك"><div class="label"><span class="name">عبد الكريم لك</span></div></li>


              </ul>
            </li>

          </ul>
        </li>
      </ul>
    </main>
  </div>

  <footer class="app">
    <p>هذا الموقع نسخة محسّنة بصريًا عن الشجرة التفاعلية الأصلية مع بحث عربي ذكي ووضع ليلي/نهاري وطباعة سهلة.</p>
  </footer>

  <script>
    // Theme toggle (persist)
    const root = document.documentElement;
    const themeBtn = document.getElementById('themeBtn');
    function applyTheme(t){ document.body.setAttribute('data-theme', t); localStorage.setItem('fam-theme', t); themeBtn.textContent = (t==='dark' ? 'الوضع النهاري' : 'الوضع الليلي'); }
    applyTheme(localStorage.getItem('fam-theme') || 'dark');
    themeBtn.addEventListener('click', ()=> applyTheme(document.body.getAttribute('data-theme')==='dark'?'light':'dark'));

    // Expand/collapse handlers
    document.addEventListener('click', function(e){
      const lbl = e.target.closest('.label');
      if(!lbl) return;
      const li = lbl.closest('li');
      if(li && li.classList.contains('node')){
        li.classList.toggle('expanded');
        updateOpenDepth();
        updateBreadcrumbs(li);
      } else if(li){
        updateBreadcrumbs(li);
      }
    });
    document.getElementById('expandAll').addEventListener('click', ()=>{
      document.querySelectorAll('.node').forEach(n => n.classList.add('expanded'));
      updateOpenDepth();
    });
    document.getElementById('collapseAll').addEventListener('click', ()=>{
      document.querySelectorAll('.node').forEach(n => n.classList.remove('expanded'));
      const root = document.querySelector('#tree > li.node');
      if(root) root.classList.add('expanded');
      updateOpenDepth();
    });
    document.getElementById('rootOpenBtn').addEventListener('click', ()=>{
      document.querySelectorAll('.node').forEach(n => n.classList.remove('expanded'));
      const root = document.querySelector('#tree > li.node');
      if(root) root.classList.add('expanded');
      updateOpenDepth();
    });
    document.getElementById('collapseTo2').addEventListener('click', ()=>{
      // expand root and its direct children only
      document.querySelectorAll('.node').forEach(n => n.classList.remove('expanded'));
      const root = document.querySelector('#tree > li.node');
      if(!root) return;
      root.classList.add('expanded');
      root.querySelectorAll(':scope > .children > li.node').forEach(n => n.classList.add('expanded'));
      updateOpenDepth();
    });

    // Search: Arabic normalization + highlight + keep ancestors expanded + count
    const q = document.getElementById('q');
    const clearBtn = document.getElementById('clearBtn');
    function removeMarks(){ document.querySelectorAll('.name').forEach(n => { n.innerHTML = n.textContent; }); }
    function ensureAncestorsExpanded(li){
      let p = li.parentElement;
      while(p){
        const owner = p.closest('li');
        if(owner && owner.classList.contains('node')){
          owner.classList.add('expanded');
          p = owner.parentElement;
        } else { p = null; }
      }
    }
    function normalize(text) {
      return text
        .replace(/[أإآا]/g, 'ا')
        .replace(/ى/g, 'ي')
        .replace(/ة/g, 'ه')
        .replace(/[\u064B-\u0652\u0670]/g, '')
        .replace(/\s+/g, ' ')
        .trim().toLowerCase();
    }
    function buildArabicPattern(str){
      const diac = '[\\u064B-\\u0652\\u0670]*';
      const map = { 'ا':'[اأإآا]', 'أ':'[اأإآا]', 'إ':'[اأإآا]', 'آ':'[اأإآا]', 'ى':'[يى]', 'ي':'[يى]', 'ة':'[ةه]', 'ه':'[هة]' };
      function esc(ch){ return /[.*+?^${}()|[\]\\]/.test(ch) ? '\\' + ch : ch; }
      let out = '';
      for(const ch of str.trim()){
        if(/\s/.test(ch)){ out += '\\s+'; }
        else if(map[ch]){ out += map[ch] + diac; }
        else { out += esc(ch) + diac; }
      }
      return new RegExp(out, 'gi');
    }
    function highlightText(el, tokens){
      const raw = el.textContent;
      if(!tokens.length) { el.innerHTML = raw; return; }
      const patterns = tokens.filter(Boolean).map(buildArabicPattern);
      let html = raw;
      for(const re of patterns){
        html = html.replace(/<\/?mark>/g, '');
        html = html.replace(re, (m) => `<mark>${m}</mark>`);
      }
      el.innerHTML = html;
    }
    function walkAndFilter(li, tokens){
      const nameEl = li.querySelector(':scope > .label .name');
      const ownRaw = nameEl ? nameEl.textContent : '';
      const ownNorm = ownRaw ? normalize(ownRaw) : '';
      const ownMatch = tokens.length ? tokens.every(t => ownNorm.includes(normalize(t))) : true;
      const childrenUL = li.querySelector(':scope > .children');
      let childMatch = false;
      if(childrenUL){
        const childLis = childrenUL.querySelectorAll(':scope > li');
        childMatch = Array.from(childLis).map(c => walkAndFilter(c, tokens)).some(Boolean);
      }
      const matched = ownMatch || childMatch;
      li.style.display = matched ? '' : 'none';
      if(ownMatch && nameEl && tokens.length){
        highlightText(nameEl, tokens);
        ensureAncestorsExpanded(li);
      }
      return matched;
    }
    function filterTree(term){
      removeMarks();
      const root = document.querySelector('#tree > li');
      if(!root) return;
      if(!term.trim()){
        document.querySelectorAll('#tree li').forEach(li => li.style.display = '');
        updateStats();
        return;
      }
      const tokens = term.split(/\s+/).map(t => t.trim()).filter(Boolean);
      walkAndFilter(root, tokens);
      updateStats();
    }
    q.addEventListener('input', ()=> filterTree(q.value));
    clearBtn.addEventListener('click', ()=>{ q.value=''; filterTree(''); });

    // Breadcrumbs
    const bc = document.getElementById('breadcrumbs');
    function updateBreadcrumbs(li){
      const parts = [];
      let cur = li;
      while(cur && cur.matches('li')){
        const nm = cur.querySelector(':scope > .label .name');
        if(nm){ parts.push(nm.textContent.trim()); }
        cur = cur.parentElement.closest('li');
      }
      parts.reverse();
      bc.innerHTML = parts.map((p,i)=> `<span class="crumb">${p}</span>`).join('');
    }

    // Stats
    function updateStats(){
      const total = document.querySelectorAll('#tree li').length;
      document.getElementById('nodeCount').textContent = total.toLocaleString('ar');
      updateOpenDepth();
    }
    function updateOpenDepth(){
      // compute deepest expanded level (root = 1)
      const root = document.querySelector('#tree > li.node');
      if(!root){ document.getElementById('openDepth').textContent = '—'; return; }
      let maxDepth = 1;
      function depth(li, d){
        maxDepth = Math.max(maxDepth, d);
        li.querySelectorAll(':scope > .children > li').forEach(c => depth(c, d+1));
      }
      depth(root, 1);
      document.getElementById('openDepth').textContent = maxDepth.toString();
    }
    updateStats();

    // Print
    document.getElementById('printBtn').addEventListener('click', ()=> window.print());
  </script>
</body>
</html>
